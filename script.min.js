const modal=document.getElementById("exampleModal"),nombreSitio=document.getElementById("titulo"),btnGuardarUrl=document.getElementById("guardar_url"),lista_url=document.getElementsByClassName("div_lista"),lista_noticias=document.getElementById("lista_noticias"),btnEnlace=document.getElementsByClassName("btnEnlace"),btnActualizar=document.getElementById("btn-actualizar"),btnBuscar=document.getElementById("btnBuscador"),campoBuscar=document.getElementById("campo_buscar"),lista_categorias=document.getElementById("div_categorias"),
btnCategorias=document.getElementById("btnCategorias"),btnCerrar=document.getElementById("btnCerrar");var noticiaActualSeleccionada;let global="";btnGuardarUrl.addEventListener("click",agregarUrl);btnActualizar.addEventListener("click",actualizarPage);btnBuscar.addEventListener("click",asignarEventoBuscar);btnCategorias.addEventListener("click",mostrarCategorias);btnCerrar.addEventListener("click",ocultarbtnCerrar);window.onload=mostrar;
function mostrar(){makeRequest("mostrarUrl.php?q=mostrar");let a=global;a&&(a=JSON.parse(global),lista_url[0].innerHTML=a.enlace,asignarEventoBoton(),agregarEventoBorrar(),mostrarNoticiasPrimero())}
function mostrarNoticiasPrimero(){if(0!=btnEnlace.length){makeRequest("mostrarNoticias.php?q="+btnEnlace[0].textContent);let a=JSON.parse(global);nombreSitio.innerHTML=btnEnlace[0].textContent;lista_noticias.innerHTML=a.noticias;noticiaActualSeleccionada=btnEnlace[0].textContent}else lista_noticias.innerHTML="<h1>No hay noticias<h1>"}
function actualizarPage(){makeRequest("actualizar.php?q="+nombreSitio.textContent);makeRequest("mostrarNoticias.php?q="+nombreSitio.textContent);let a=JSON.parse(global);lista_noticias.innerHTML=a.noticias;noticiaActualSeleccionada=nombreSitio.textContent}function asignarEventoBoton(){for(let a=0;a<btnEnlace.length;a++)btnEnlace[a].addEventListener("click",mostrarNoticias)}
function mostrarNoticias(){makeRequest("mostrarNoticias.php?q="+this.textContent);let a=JSON.parse(global);nombreSitio.innerHTML=this.textContent;lista_noticias.innerHTML=a.noticias;noticiaActualSeleccionada=this.textContent}function agregarUrl(){let a=document.getElementById("url_modal").value;makeRequest("agregarUrl.php?q="+a);mostrar()}
function makeRequest(a){var b=new XMLHttpRequest;b.onreadystatechange=function(){4==this.readyState&&200==this.status&&(global=this.responseText)};b.open("GET",a,!1);b.send()}function validURL(a){return!!RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(a)}
function agregarEventoBorrar(){const a=document.getElementsByClassName("btnEliminar");for(let b=0;b<a.length;b++)a[b].addEventListener("click",borrar)}function borrar(){let a=this.parentNode.childNodes;makeRequest("delete.php?q="+a[1].textContent);"undefined"!==typeof noticiaActualSeleccionada&&noticiaActualSeleccionada==a[1].textContent&&(nombreSitio.innerHTML="",lista_noticias.innerHTML="");mostrar()}
function asignarEventoBuscar(){var a=document.getElementById("campo_buscar").value;makeRequest("buscador.php?q="+a);(a=global)?(a=JSON.parse(global),nombreSitio.innerHTML="Resultados de Busqueda",lista_noticias.innerHTML=a.noticias):console.log("No hay nada!")}function ordenar(){var a=document.getElementById("selectOrden").value;makeRequest("ordenamiento.php?q="+nombreSitio.textContent+"&p="+a);a=JSON.parse(global);lista_noticias.innerHTML=a.noticias}
function mostrarCategorias(){mostrarbtnCerrar();makeRequest("mostrarCategoria.php?q=categorias");let a=JSON.parse(global);lista_categorias.innerHTML=a.categories}function mostrarbtnCerrar(){document.getElementById("sec_categorias").style.display="block";document.getElementById("btnCerrar").style.display="block"}function ocultarbtnCerrar(){document.getElementById("sec_categorias").style.display="none";document.getElementById("btnCerrar").style.display="none"}
function cargarNoticiasPorCategoria(a){a=a.value;nombreSitio.innerHTML="Categor\u00eda:  "+a;makeRequest("mostrarNoticiasPorCategoria.php?q="+a);(a=global)?(a=JSON.parse(global),lista_noticias.innerHTML=a.noticias):console.log("No hay nada!")};
